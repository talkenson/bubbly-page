(window.webpackJsonpbubbly=window.webpackJsonpbubbly||[]).push([[0],{131:function(e,t,a){},228:function(e,t,a){e.exports=a(364)},346:function(e,t,a){},348:function(e,t,a){},349:function(e,t,a){},364:function(e,t,a){"use strict";a.r(t);a(229),a(255),a(257),a(258),a(260),a(261),a(262),a(263),a(264),a(265),a(266),a(267),a(269),a(270),a(271),a(272),a(273),a(274),a(275),a(276),a(277),a(278),a(280),a(281),a(282),a(283),a(284),a(285),a(286),a(287),a(288),a(289),a(290),a(291),a(292),a(293),a(294),a(295),a(296),a(297);var n=a(0),s=a.n(n),c=a(61),l=a.n(c),r=a(48),o=a.n(r),i=a(35),u=a.n(i),m=a(47),d=a(97),h=a.n(d),f=a(147),p=a.n(f),g=a(148),b=a.n(g),v=a(62),E=a.n(v),k=a(149),x=a.n(k),y=a(99),O=a.n(y),j=(a(306),a(56)),w=a.n(j),C=a(49),S=a.n(C),I=a(44),N=a.n(I),M=a(39),_=a.n(M),U=a(46),D=a.n(U),A=a(40),L=a.n(A),B=a(34),z=a.n(B),R=(a(131),function(e){var t=e.id,a=e.go,n=e.fetchedUser;e.setActiveModal;return s.a.createElement(S.a,{id:t},s.a.createElement(N.a,{className:"Panel"},"Bubbly"),n&&s.a.createElement(D.a,{title:"\u0412\u044b \u0432\u043e\u0448\u043b\u0438 \u043a\u0430\u043a"},s.a.createElement(L.a,{description:n.data?"".concat(n.first_name," ").concat(n.last_name):"\u041c\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u0430\u0448\u0438 \u0434\u0430\u043d\u043d\u044b\u0435..."},"".concat(n.data?n.data.uname:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."))),s.a.createElement(D.a,{title:"\u0427\u0430\u0442\u044b"},s.a.createElement(z.a,null,s.a.createElement(_.a,{size:"xl",level:"2",onClick:a,"data-to":"chat"},s.a.createElement(L.a,{description:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f"},"".concat(n&&n.data?n.data.motd:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."))))),s.a.createElement(D.a,{title:"\u0414\u0438\u0430\u043b\u043e\u0433\u0438"},s.a.createElement(z.a,null,s.a.createElement(_.a,{size:"xl",level:"2"},s.a.createElement(L.a,{description:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0435\u0435 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435?"},"\u0421\u043a\u043e\u0440\u043e...")))),s.a.createElement(D.a,{title:"\u0412\u0435\u0440\u0441\u0438\u044f \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f"},s.a.createElement(z.a,null,"0.1.22.0212 (Build Date: ","2020-1-26 1:24:12",".)")))}),T=a(100),P=a(50),V=a(51),H=a(54),K=a(52),W=a(63),G=a(55),J=a(45),q=a(143),F=a.n(q),Y=a(75),Z=a.n(Y),Q=a(138),X=a.n(Q),$=a(139),ee=a.n($),te=(a(338),a(140)),ae=a.n(te),ne=a(141),se=a.n(ne),ce=a(53),le=a.n(ce),re=a(73),oe=a.n(re),ie=a(145),ue=a.n(ie),me=a(144),de=a.n(me),he=a(146),fe=a.n(he),pe=a(98),ge=(a(346),a(142)),be=(a(348),Object(J.b)(),function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).state={isVisible:!1,id:e.data.id,author:e.data.author,text:e.data.text,time:e.data.ts,owner:e.owner},a.align="left",a.color="dark",a}return Object(G.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){this.align=this.state.author===this.state.owner?"right":"left",this.color=["space_gray","dark_client"].includes(document.body.attributes.scheme.value)?"dark":"light",this.setState({isVisible:!0})}},{key:"render",value:function(){return s.a.createElement("div",{className:"row",style:{opacity:this.state.isVisible?"1":"0"}},s.a.createElement("div",{className:"block ".concat(this.align," ").concat(this.color)},s.a.createElement("span",{className:"author"},this.state.author),s.a.createElement("div",{className:"text"},this.state.text),s.a.createElement("span",{className:"time"},ge.unix(this.state.time).format("HH:mm"))))}}]),t}(s.a.Component)),ve=(a(349),Object(J.b)(),function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).state={},a}return Object(G.a)(t,e),Object(V.a)(t,[{key:"componentDidMount",value:function(){console.log(this.props)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{className:"circle",onClick:function(){e.props.scroller.scrollToBottom()}},s.a.createElement("div",{className:"arrow"},s.a.createElement(Z.a,null)))}}]),t}(s.a.Component)),Ee=Object(J.b)(),ke=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(H.a)(this,Object(K.a)(t).call(this,e))).state={msgList:[],err:null,fetchedUser:e.fetchedUser,last_msg:0,scroller:!1,contextOpened:!1,mode:"all"},a.textInput=s.a.createRef(),a.pollBack=!0,a.toggleContext=a.toggleContext.bind(Object(W.a)(a)),a.select=a.select.bind(Object(W.a)(a)),a}return Object(G.a)(t,e),Object(V.a)(t,[{key:"toggleContext",value:function(){this.setState({contextOpened:!this.state.contextOpened})}},{key:"select",value:function(e){var t=e.currentTarget.dataset.mode;this.setState({mode:t}),requestAnimationFrame(this.toggleContext)}},{key:"componentDidMount",value:function(){var e=this;this.focusTextInput(),this.refreshMsgs(),console.log(this.state),this.interval=setInterval((function(){e.checkScroll()}),1e3)}},{key:"componentDidUpdate",value:function(){}},{key:"componentWillUnmount",value:function(){this.pollBack=!1,clearInterval(this.interval)}},{key:"checkScroll",value:function(){document.body.scrollHeight-window.innerHeight-window.pageYOffset<200?(pe.animateScroll.scrollToBottom(),this.setState({scroller:!1})):this.setState({scroller:!0})}},{key:"processMsgs",value:function(e){0!==e.length&&(this.setState({msgList:[].concat(Object(T.a)(this.state.msgList),Object(T.a)(e))}),this.state.last_msg=this.state.msgList[this.state.msgList.length-1].id)}},{key:"refreshMsgs",value:function(){var e=this;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.pollBack){t.next=5;break}return t.next=3,u.a.awrap(w.a.post("https://das.ict.nsc.ru:12000/updates",{token:this.props.fetchedUser.data.token,last_msg:this.state.last_msg}).then((function(t){"ok"==t.data.status?t.data.total>0&&e.processMsgs(t.data.response):console.log(t.data.desc)})));case 3:t.next=0;break;case 5:case"end":return t.stop()}}),null,this)}},{key:"sendMsg",value:function(){var e=this;if(this.focusTextInput(),0===this.textInput.current.value.trim().length)return this.textInput.current.value="",!1;w.a.post("https://das.ict.nsc.ru:12000/send",{token:this.props.fetchedUser.data.token,message:this.textInput.current.value}).then((function(t){if("ok"==t.data.status);else switch(console.log(t.data.desc),t.data.code){case"402":e.setState({err:"\u0412\u0430\u0448\u0430 \u0441\u0435\u0441\u0441\u0438\u044f \u043d\u0435\u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u0430"});break;case"501":e.setState({err:"\u041d\u0435 \u043f\u0440\u0435\u0434\u043e\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u043e \u0434\u0430\u043d\u043d\u044b\u0445"});break;default:e.setState({err:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430"})}})),this.textInput.current.value=""}},{key:"focusTextInput",value:function(){this.textInput.current.focus()}},{key:"render",value:function(){var e=this;return s.a.createElement(S.a,{id:this.props.id},s.a.createElement(N.a,{left:s.a.createElement(F.a,{onClick:this.props.go,"data-to":"home"},Ee===J.a?s.a.createElement(Z.a,null):s.a.createElement(X.a,null))},s.a.createElement(de.a,{aside:s.a.createElement(ee.a,null),onClick:this.toggleContext},"\u0427\u0430\u0442")),s.a.createElement(ue.a,{opened:this.state.contextOpened,onClose:this.toggleContext},s.a.createElement(fe.a,null,s.a.createElement(L.a,{before:s.a.createElement(ae.a,null),onClick:this.select,"data-mode":"users"},"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0438"),s.a.createElement(L.a,{before:s.a.createElement(se.a,null),onClick:this.select,"data-mode":"settings"},"\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438"))),1==this.state.scroller?s.a.createElement(ve,{scroller:pe.animateScroll,onClick:function(){e.setState({scroller:!1})}}):"",s.a.createElement("div",{className:"historyGroup"},0===this.state.msgList.length?s.a.createElement(oe.a,null):this.state.msgList.map((function(t,a){return s.a.createElement(be,{data:t,owner:e.state.fetchedUser.data.uname,key:"msg-"+a})}))),s.a.createElement(D.a,{className:"inputRow"},s.a.createElement(z.a,{style:{display:"flex"},className:"minimalDiv"},s.a.createElement(le.a,{placeholder:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",className:"msgInput",getRef:this.textInput,onKeyDown:function(t){"Enter"==t.key&&e.sendMsg()},status:null==this.state.err?"valid":"error",top:null==this.state.err?null:this.state.err}),s.a.createElement(_.a,{size:"xl",level:"1",className:"msgBtn",onClick:function(){e.sendMsg()}},"\u041e\u0442\u043f\u0440."))))}}]),t}(s.a.Component),xe=a(74),ye=a.n(xe),Oe=function(e){var t=e.id,a=e.logDataName,n=e.logDataPass,c=e.tryLogin,l=e.errMsg;return s.a.createElement(S.a,{id:t},s.a.createElement(N.a,{className:"Panel"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),s.a.createElement(E.a,null,s.a.createElement(ye.a,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"},s.a.createElement(le.a,{placeholder:"\u0412\u0430\u0448 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c",id:"name",getRef:a}),s.a.createElement(le.a,{placeholder:"\u0412\u0430\u0448 \u043f\u0430\u0440\u043e\u043b\u044c",id:"pass",getRef:n})),s.a.createElement(_.a,{size:"xl",level:"2",onClick:function(){console.log(a.current.value),console.log(n.current.value),c()}},"\u0412\u043e\u0439\u0442\u0438"),s.a.createElement(z.a,null,s.a.createElement("b",null,l&&l))))},je={id:2,first_name:"\u0424\u0438\u043b\u0438\u043f\u043f \u0414\u0436\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u0438",last_name:"",timezone:7},we=function(){var e=Object(n.useState)("home"),t=Object(m.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),r=Object(m.a)(l,2),i=r[0],d=r[1],f=Object(n.useState)(je),g=Object(m.a)(f,2),v=g[0],k=g[1],y=Object(n.useState)(null),j=Object(m.a)(y,2),C=j[0],S=(j[1],Object(n.useState)(null)),I=Object(m.a)(S,2),N=I[0],M=I[1],_=Object(n.useState)(s.a.createElement(O.a,{size:"large"})),U=Object(m.a)(_,2),D=U[0],A=U[1];console.log(v),Object(n.useEffect)((function(){o.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var s=document.createAttribute("scheme");s.value=n.scheme?n.scheme:"client_dark",document.body.attributes.setNamedItem(s)}})),function(){var e,t;u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(document.body.attributes.scheme||((e=document.createAttribute("scheme")).value="space_gray",document.body.attributes.setNamedItem(e)),t=null,console.log(window.location.href),":"!=window.location.href[4]){a.next=8;break}t=v,console.log("Local version"),a.next=12;break;case 8:return console.log("Global version"),a.next=11,u.a.awrap(o.a.sendPromise("VKWebAppGetUserInfo"));case 11:t=a.sent;case 12:return k(t),a.next=15,u.a.awrap(w.a.get("https://das.ict.nsc.ru:12000/reg/"+t.id+":0:secret").then((function(e){"ok"==e.data.status?t.data=e.data.response:c("login")})));case 15:a.sent,k(t),A(null);case 18:case"end":return a.stop()}}))}()}),[]);var L=function(e){c(e.currentTarget.dataset.to)},B=s.a.createRef(),z=s.a.createRef();var T=s.a.createElement(p.a,{activeModal:i},s.a.createElement(b.a,{id:"register",header:s.a.createElement(x.a,null,"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")},s.a.createElement(E.a,null)));return s.a.createElement(h.a,{activePanel:a,popout:D,modal:T},s.a.createElement(R,{id:"home",fetchedUser:v,go:L,setActiveModal:d}),s.a.createElement(ke,{id:"chat",go:L,activeChat:C,fetchedUser:v}),s.a.createElement(Oe,{id:"login",logDataName:B,logDataPass:z,tryLogin:function(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=v,A(s.a.createElement(O.a,{size:"large"})),!(B.current.value.length<1||z.current.value.length<1)){t.next=6;break}return M("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"),A(null),t.abrupt("return",!1);case 6:return t.next=8,u.a.awrap(w.a.get("https://das.ict.nsc.ru:12000/reg/"+e.id+":"+B.current.value+":"+z.current.value).then((function(t){if("ok"==t.data.status)e.data=t.data.response,c("home");else switch(console.log("Auth Error: "+t.data.desc),t.data.code){case"401":M("\u0412\u044b \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b");break;case"306":M("\u041d\u0438\u043a\u043d\u0435\u0439\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0440\u0435\u0434\u0438 [A-Za-z0-9\\_\\-\\.]");break;case"302":M("\u0414\u043b\u0438\u043d\u0430 \u043d\u0438\u043a\u043d\u0435\u0439\u043c\u0430 \u0438 \u043f\u0430\u0440\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u0435\u0435 4");break;default:M("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430")}})));case 8:t.sent,k(e),A(null);case 11:case"end":return t.stop()}}))},errMsg:N}))};o.a.send("VKWebAppInit"),l.a.render(s.a.createElement(we,null),document.getElementById("root"))}},[[228,1,2]]]);
//# sourceMappingURL=main.91b774af.chunk.js.map