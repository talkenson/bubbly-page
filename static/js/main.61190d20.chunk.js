(window.webpackJsonpbubbly=window.webpackJsonpbubbly||[]).push([[0],{119:function(e,t,a){},220:function(e,t,a){e.exports=a(352)},338:function(e,t,a){},352:function(e,t,a){"use strict";a.r(t);a(221),a(247),a(249),a(250),a(252),a(253),a(254),a(255),a(256),a(257),a(258),a(259),a(261),a(262),a(263),a(264),a(265),a(266),a(267),a(268),a(269),a(270),a(272),a(273),a(274),a(275),a(276),a(277),a(278),a(279),a(280),a(281),a(282),a(283),a(284),a(285),a(286),a(287),a(288),a(289);var n=a(0),s=a.n(n),c=a(53),r=a.n(c),l=a(46),o=a.n(l),i=a(34),u=a.n(i),d=a(45),m=a(139),p=a.n(m),h=a(136),f=a.n(h),g=a(137),b=a.n(g),E=a(55),v=a.n(E),k=a(138),y=a.n(k),x=a(86),w=a.n(x),O=(a(298),a(49)),j=a.n(O),I=a(47),M=a.n(I),N=a(42),S=a.n(N),U=a(43),A=a.n(U),B=a(44),D=a.n(B),z=a(54),L=a.n(z),C=a(33),R=a.n(C),T=(a(119),function(e){var t=e.id,a=e.go,n=e.fetchedUser;e.setActiveModal;return s.a.createElement(M.a,{id:t},s.a.createElement(S.a,{className:"Panel"},"Bubbly"),n&&s.a.createElement(D.a,{title:"\u0412\u044b \u0432\u043e\u0448\u043b\u0438 \u043a\u0430\u043a"},s.a.createElement(L.a,{description:n.data?"".concat(n.first_name," ").concat(n.last_name):"\u041c\u044b \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c \u0432\u0430\u0448\u0438 \u0434\u0430\u043d\u043d\u044b\u0435..."},"".concat(n.data?n.data.uname:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."))),s.a.createElement(D.a,{title:"\u0427\u0430\u0442\u044b"},s.a.createElement(R.a,null,s.a.createElement(A.a,{size:"xl",level:"2",onClick:a,"data-to":"chat"},s.a.createElement(L.a,{description:"\u041d\u0430\u0436\u043c\u0438\u0442\u0435, \u0447\u0442\u043e\u0431\u044b \u043f\u0440\u0438\u0441\u043e\u0435\u0434\u0438\u043d\u0438\u0442\u044c\u0441\u044f"},"".concat(n&&n.data?n.data.motd:"\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430..."))))),s.a.createElement(D.a,{title:"\u0412\u0435\u0440\u0441\u0438\u044f \u043f\u0440\u0438\u043b\u043e\u0436\u0435\u043d\u0438\u044f"},s.a.createElement(R.a,null,"0.1.7.0221 (Build Date: ","2020-1-7 2:22:13",".)")))}),_=a(87),K=a(127),P=a(128),W=a(140),G=a(129),V=a(141),J=a(88),Z=a(133),q=a.n(Z),F=a(135),H=a.n(F),Q=a(130),X=a.n(Q),Y=a(131),$=a.n(Y),ee=a(48),te=a.n(ee),ae=a(134),ne=a.n(ae),se=a(132),ce=(a(338),Object(J.b)()),re=function(e){function t(e){var a;return Object(K.a)(this,t),(a=Object(W.a)(this,Object(G.a)(t).call(this,e))).textInput=s.a.createRef(),a.pollBack=!0,a.state={msgList:[],err:null},a}return Object(V.a)(t,e),Object(P.a)(t,[{key:"componentDidMount",value:function(){this.focusTextInput(),this.refreshMsgs()}},{key:"componentDidUpdate",value:function(){se.animateScroll.scrollToBottom()}},{key:"componentWillUnmount",value:function(){this.pollBack=!1}},{key:"processMsgs",value:function(e){this.setState({msgList:[].concat(Object(_.a)(this.state.msgList),Object(_.a)(e))})}},{key:"refreshMsgs",value:function(){var e=this;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:console.log("Trying to fetch history with TOKEN["+this.props.fetchedUser.data.token+"]");case 1:if(!this.pollBack){t.next=6;break}return t.next=4,u.a.awrap(j.a.post("https://das.ict.nsc.ru:12000/updates",{token:this.props.fetchedUser.data.token}).then((function(t){console.log(t),"ok"==t.data.status?t.data.total>0&&e.processMsgs(t.data.response):console.log(t.data.desc)})));case 4:t.next=1;break;case 6:case"end":return t.stop()}}),null,this)}},{key:"sendMsg",value:function(){var e=this;console.log(this.textInput.current.value),console.log("Sending message with TOKEN["+this.props.fetchedUser.data.token+"]"),j.a.post("https://das.ict.nsc.ru:12000/send",{token:this.props.fetchedUser.data.token,message:this.textInput.current.value}).then((function(t){if(console.log(t),"ok"==t.data.status);else switch(console.log(t.data.desc),t.data.code){case"402":e.setState({err:"\u0412\u044b \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b"});break;case"501":e.setState({err:"\u041d\u0438\u043a\u043d\u0435\u0439\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0440\u0435\u0434\u0438 [A-Za-z0-9\\_\\-\\.]"});break;default:e.setState({err:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430"})}})),this.textInput.current.value=""}},{key:"focusTextInput",value:function(){this.textInput.current.focus()}},{key:"render",value:function(){var e=this;return s.a.createElement(M.a,{id:this.props.id},s.a.createElement(S.a,{left:s.a.createElement(q.a,{onClick:this.props.go,"data-to":"home"},ce===J.a?s.a.createElement(X.a,null):s.a.createElement($.a,null))},"\u0427\u0430\u0442"),s.a.createElement(D.a,{className:"historyGroup"},s.a.createElement(R.a,null,0==this.state.msgList?s.a.createElement(ne.a,null):this.state.msgList.map((function(e){return s.a.createElement(H.a,{key:e.id,className:"msgBox",id:"msg-id".concat(e.id),title:"".concat(e.uname)},e.message)})))),s.a.createElement(D.a,{className:"inputRow"},s.a.createElement(R.a,{style:{display:"flex"},className:"minimalDiv"},s.a.createElement(te.a,{placeholder:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",className:"msgInput",getRef:this.textInput,onKeyDown:function(t){"Enter"==t.key&&e.sendMsg()},status:null==this.state.err?"valid":"error",bottom:null==this.state.err?null:this.state.err}),s.a.createElement(A.a,{size:"xl",level:"1",className:"msgBtn",onClick:function(){e.sendMsg()}},"\u041e\u0442\u043f\u0440."))))}}]),t}(s.a.Component),le=a(64),oe=a.n(le),ie=function(e){var t=e.id,a=e.logDataName,n=e.logDataPass,c=e.tryLogin,r=e.errMsg;return s.a.createElement(M.a,{id:t},s.a.createElement(S.a,{className:"Panel"},"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f"),s.a.createElement(v.a,null,s.a.createElement(oe.a,{top:"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"},s.a.createElement(te.a,{placeholder:"\u0412\u0430\u0448 \u043f\u0441\u0435\u0432\u0434\u043e\u043d\u0438\u043c",id:"name",getRef:a}),s.a.createElement(te.a,{placeholder:"\u0412\u0430\u0448 \u043f\u0430\u0440\u043e\u043b\u044c",id:"pass",getRef:n})),s.a.createElement(A.a,{size:"xl",level:"2",onClick:function(){console.log(a.current.value),console.log(n.current.value),c()}},"\u0412\u043e\u0439\u0442\u0438"),s.a.createElement(R.a,null,s.a.createElement("b",null,r&&r))))},ue={id:2,first_name:"\u0424\u0438\u043b\u0438\u043f\u043f \u0414\u0436\u0430\u043d\u043a\u043e\u0432\u0441\u043a\u0438",last_name:"",timezone:7},de=function(){var e=Object(n.useState)("home"),t=Object(d.a)(e,2),a=t[0],c=t[1],r=Object(n.useState)(null),l=Object(d.a)(r,2),i=l[0],m=l[1],h=Object(n.useState)(ue),g=Object(d.a)(h,2),E=g[0],k=g[1],x=Object(n.useState)(null),O=Object(d.a)(x,2),I=O[0],M=(O[1],Object(n.useState)(null)),N=Object(d.a)(M,2),S=N[0],U=N[1],A=Object(n.useState)(s.a.createElement(w.a,{size:"large"})),B=Object(d.a)(A,2),D=B[0],z=B[1];console.log(E),Object(n.useEffect)((function(){o.a.subscribe((function(e){var t=e.detail,a=t.type,n=t.data;if("VKWebAppUpdateConfig"===a){var s=document.createAttribute("scheme");s.value=n.scheme?n.scheme:"client_dark",document.body.attributes.setNamedItem(s)}})),function(){var e;u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=null,console.log(window.location.href),":"!=window.location.href[4]){t.next=7;break}e=E,console.log("Local version"),t.next=11;break;case 7:return console.log("Global version"),t.next=10,u.a.awrap(o.a.sendPromise("VKWebAppGetUserInfo"));case 10:e=t.sent;case 11:return k(e),t.next=14,u.a.awrap(j.a.get("https://das.ict.nsc.ru:12000/reg/"+e.id+":0:secret").then((function(t){"ok"==t.data.status?e.data=t.data.response:c("login")})));case 14:t.sent,k(e),z(null);case 17:case"end":return t.stop()}}))}()}),[]);var L=function(e){c(e.currentTarget.dataset.to)},C=s.a.createRef(),R=s.a.createRef();var _=s.a.createElement(f.a,{activeModal:i},s.a.createElement(b.a,{id:"register",header:s.a.createElement(y.a,null,"\u0420\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u044f")},s.a.createElement(v.a,null)));return s.a.createElement(p.a,{activePanel:a,popout:D,modal:_},s.a.createElement(T,{id:"home",fetchedUser:E,go:L,setActiveModal:m}),s.a.createElement(re,{id:"chat",go:L,activeChat:I,fetchedUser:E}),s.a.createElement(ie,{id:"login",logDataName:C,logDataPass:R,tryLogin:function(){var e;return u.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=E,z(s.a.createElement(w.a,{size:"large"})),!(C.current.value.length<1||R.current.value.length<1)){t.next=6;break}return U("\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0432\u0441\u0435 \u0434\u0430\u043d\u043d\u044b\u0435"),z(null),t.abrupt("return",!1);case 6:return t.next=8,u.a.awrap(j.a.get("https://das.ict.nsc.ru:12000/reg/"+e.id+":"+C.current.value+":"+R.current.value).then((function(t){if("ok"==t.data.status)e.data=t.data.response,c("home");else switch(console.log("Auth Error: "+t.data.desc),t.data.code){case"401":U("\u0412\u044b \u0443\u0436\u0435 \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u043d\u044b");break;case"306":U("\u041d\u0438\u043a\u043d\u0435\u0439\u043c \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0441\u0440\u0435\u0434\u0438 [A-Za-z0-9\\_\\-\\.]");break;case"302":U("\u0414\u043b\u0438\u043d\u0430 \u043d\u0438\u043a\u043d\u0435\u0439\u043c\u0430 \u0438 \u043f\u0430\u0440\u043e\u043b\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u0435\u0435 4");break;default:U("\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430")}})));case 8:t.sent,k(e),z(null);case 11:case"end":return t.stop()}}))},errMsg:S}))};o.a.send("VKWebAppInit"),r.a.render(s.a.createElement(de,null),document.getElementById("root"))}},[[220,1,2]]]);
//# sourceMappingURL=main.61190d20.chunk.js.map